using System;

//                           -- PUZZLE -- 
//
//	A warden has a challenge for his 100 prisoners. Once per day, he will
//	choose one of them at random and bring them to a room with nothing but 
//	a light bulb. The prisoner may change the state of the light bulb. 
//  Nothing about this room can be seen from the outside; a prisoner must be
//  in the room to see the state of the light bulb. Once the prisoners are
//  100% sure that every single one of them has been in the room, he will set
//  them free. If they are wrong, he will execute all of them.
//
//  The warden gives the prisoners an hour to work on a plan together, but then
//  they will never see each other again until the trials are over. The ONLY
//  means of communication the prisoners will have with each other is the
//  state of the light bulb in the room. There is no trickery going on with
//  this puzzle, there is no way around it. The light is the only form
//  of communication. What is the strategy the prisoners come up with?
//
//                           -- SOLUTION --
//
//  The prisoners choose from among themselves a "reporter". If any of the
//  other prisoners go into the room and the light is off, AND they have never
//  turned on the light before, they turn it on. Otherwise, they do nothing.
//  If the reporter walks into the room and sees that the light is on, he turns
//  it off and increments his count. If he sees that the light is off, he does
//  nothing (this indicates that no new prisoner has been in the room since his
//  last visit). Once his count increases to 99 (plus one for himself), he can 
//  be sure that everyone has been in the room.
//
//  So, how long does this take?

					
public class Program
{
	bool[] prisonerLight = new bool[50000];
	
	int numDays(int numPrisoners, ref int badcount)
	{
		Random rnd = new Random();
		int days=0;//Number of days taken
		bool light = false;//Current state of light
		int chosen = 0;//Prisoner who was chosen today
		int count = 1;//Number of prisoners counted (start with N=1 for the reporter)
		
		initializePrisoners(numPrisoners);
				
		while(count<numPrisoners)
		{
			while(light==false)
			{
				chosen = rnd.Next(0,numPrisoners);
				if(prisonerLight[chosen]==false)//if chosen has never turned the light on before
				{
					light = true;
					prisonerLight[chosen] = true;//turn it on and remember
				}
				else //this day was a waste
				{
					days++;
					if(chosen==0)
						badcount++;//if the reporter walks in the room and the light is off
				}
			}
			do
			{
				if(chosen==0) //the chosen walked in and saw the light was on. yay!
				{
					count++;
					light = false;
				}
				else
				{
					days++; //a random prisoner walked in and saw the light was on
					chosen = rnd.Next(0,numPrisoners);
				}
			}while(light==true);
		}
		return days;
	}
	
	void initializePrisoners(int numPrisoners)
	{
		for (int i=1; i<numPrisoners; i++)
			prisonerLight[i]=false;
		prisonerLight[0]=true; //prisoner#0 is the reporter, doesn't need to report himself
	}
	
	void multipleRuns(int times, int prisoners, ref int badcount)
	{		
		int sum = 0;
		for(int i=0; i<times; i++)
			sum = sum + numDays(prisoners, ref badcount);
		Console.Write("Trial: " + times + " iterations of " + prisoners + " prisoners." + "\r\n");
		Console.Write("The prisoners were in prison for " + sum/times + " days on average." + "\r\n");
		Console.Write("The reporter saw a light switch that was off " + Decimal.Divide(badcount, times) + " times on average.");
	}
		
		
	
	public void Main()
	{
		int badcount = 0;//Total number of times the reporter walked in and saw the light off.
		multipleRuns(8000, 100, ref badcount);
	}
}